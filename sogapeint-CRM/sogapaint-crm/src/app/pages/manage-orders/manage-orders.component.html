<!-- <pre>{{ orders | json }}</pre> -->
<div class="container-fluid">
    <app-pagetitle title="Commandes" [breadcrumbItems]="breadCrumbItems"></app-pagetitle>
    <div class="container mt-4">
        <!-- <div class="alert alert-danger" role="alert">
            <strong>Attention !</strong> Ce composant est encore en construction. Portez un casque de sécurité !
        </div> -->
        
        <div class="search-container">
            <input type="text" class="form-control search-input" placeholder="Rechercher..." [(ngModel)]="filter" (input)="onSearch()" />
            <div class="tags-in-search">
                <ng-container *ngFor="let tag of activeTags">
                    <div class="search-tag badge bg-success" (click)="deactivateTag(tag, $event)">
                        {{ tag }}
                        <span class="fa fa-times remove-tag-icon" (click)="deactivateTag(tag, $event)"></span>
                    </div>
                </ng-container>
            </div>
        </div>
        <br/>
        <p>Vous pouvez filtrer les commandes selon l'état des contrats :</p>
        <div class="available-tags mb-3">
            <div *ngFor="let tag of availableTags" class="badge bg-primary" (click)="activateTag(tag)">
                {{ tag }}
            </div>
        </div>
        
        
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" (click)="onSort('internal_number')">
                            Numéro interne
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'internal_number'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'internal_number' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'internal_number' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('customer')">
                            Client
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'customer'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'customer' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'customer' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('contact')">
                            Contact
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'contact'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'contact' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'contact' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('external_contributor')">
                            Co-traitant
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'external_contributor'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'external_contributor' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'external_contributor' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('benefit')">
                            Prestation
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'benefit'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'benefit' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'benefit' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('date_cde')">
                            Date de commande
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'date_cde'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'date_cde' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'date_cde' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('status')">
                            Statut
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'status'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'status' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'status' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('amount_ht')">
                            Montant HT
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'amount_ht'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'amount_ht' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'amount_ht' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('start_date_works')">
                            Début des travaux
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'start_date_works'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'start_date_works' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'start_date_works' && sortDirection === 'desc'"></i>
                        </th>
                        <th scope="col" (click)="onSort('end_date_works')">
                            Fin des travaux
                            <i class="fas fa-sort float-end" *ngIf="sortColumn !== 'end_date_works'"></i>
                            <i class="fas fa-sort-up float-end" *ngIf="sortColumn === 'end_date_works' && sortDirection === 'asc'"></i>
                            <i class="fas fa-sort-down float-end" *ngIf="sortColumn === 'end_date_works' && sortDirection === 'desc'"></i>
                        </th>
                    </tr>
                </thead>
                
                <tbody class="tbody-scrollable">
                    
                    <tr *ngFor="let order of filteredOrders; trackBy: trackByFn" (click)="selectOrder(order)">
                        <!-- <td>{{ order?.internal_number }}</td>
                        <td>{{ order?.customer?.firstname }} {{ order?.customer?.lastname }}</td> 
                        <td>{{ order?.contact?.firstname }} {{ order?.contact?.lastname }}</td> 
                        <td>{{ order?.external_contributor?.firstname }} {{ order?.external_contributor?.lastname }}</td> 
                        <td>{{ order?.benefit }}</td>
                        <td>{{ order?.date_cde | date: 'shortDate' }}</td>
                        <td>{{ order?.amount_ht | currency:'EUR':'symbol-narrow':'1.2-2':'fr'  }}</td>
                        <td>{{ order?.start_date_works | date:'shortDate' }}</td>
                        <td>{{ order?.end_date_works | date:'shortDate' }}</td> -->
                        <td ngbTooltip="{{ order?.internal_number }}">{{ order?.internal_number }}</td>
                        <td ngbTooltip="{{ order?.customer?.firstname }} {{ order?.customer?.lastname }}">
                          {{ order?.customer?.firstname }} {{ order?.customer?.lastname }}
                        </td>
                        <td ngbTooltip="{{ order?.contact?.firstname }} {{ order?.contact?.lastname }}">
                          {{ order?.contact?.firstname }} {{ order?.contact?.lastname }}
                        </td>
                        <td ngbTooltip="{{ order?.external_contributor?.firstname }} {{ order?.external_contributor?.lastname }}">
                          {{ order?.external_contributor?.firstname }} {{ order?.external_contributor?.lastname }}
                        </td>
                        <td ngbTooltip="{{ order?.benefit }}">{{ order?.benefit }}</td>
                        <td ngbTooltip="{{ order?.date_cde }}">
                          {{ order?.date_cde | date: 'shortDate' }}
                        </td>
                        <td ngbTooltip="{{ order?.amount_ht | currency:'EUR':'symbol-narrow':'1.2-2':'fr' }}">
                          {{ order?.amount_ht | currency:'EUR':'symbol-narrow':'1.2-2':'fr' }}
                        </td>
                        <td ngbTooltip="{{ order?.start_date_works }}">
                          {{ order?.start_date_works | date:'shortDate' }}
                        </td>
                        <td ngbTooltip="{{ order?.end_date_works }}">
                          {{ order?.end_date_works | date:'shortDate' }}
                        </td>
                    </tr>
                </tbody>
            </table>
            <app-loading *ngIf="isLoading"></app-loading>
            
        </div>
        <!-- <app-loading *ngIf="isLoading"></app-loading> -->
        <!-- <pre>{{ orders | json }}</pre> -->
    </div>
</div>

