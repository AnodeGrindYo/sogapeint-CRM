<div class="container-fluid">
    <app-pagetitle title="Détails de l'Entreprise" [breadcrumbItems]="breadCrumbItems"></app-pagetitle>
    <div class="container mt-4">
        <ngb-alert *ngIf="successMessage" type="success" (close)="successMessage = ''">{{ successMessage }}</ngb-alert>
        <ngb-alert *ngIf="errorMessage" type="danger" (close)="errorMessage = ''">{{ errorMessage }}</ngb-alert>
        <app-loading *ngIf="isLoading"></app-loading>
        
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">{{ company?.normalized_name }}</h5>
                <div class="row" *ngIf="isAdminOrSuperAdmin()">
                    <div class="text-end">
                        <button class="btn btn-primary ms-2" (click)="editCompany()">Editer</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-industry"></i> Industries</h6>
                        <p>{{ company?.industry?.join(', ') || 'Non renseigné' }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-globe"></i> Sites Web</h6>
                        <p *ngIf="!company?.websites?.length">Non renseigné</p>
                        <ul *ngIf="company?.websites?.length">
                            <li *ngFor="let website of company?.websites">{{ website }}</li>
                        </ul>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-phone"></i> Téléphones</h6>
                        <p *ngIf="!company?.phone?.length">Non renseigné</p>
                        <ul *ngIf="company?.phone?.length">
                            <li *ngFor="let phone of company?.phone">{{ phone }}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-envelope"></i> Emails</h6>
                        <p *ngIf="!company?.email?.length">Non renseigné</p>
                        <ul *ngIf="company?.email?.length">
                            <li *ngFor="let email of company?.email">{{ email }}</li>
                        </ul>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-map-marker-alt"></i> Adresse</h6>
                        <p>{{ company?.address || 'Non renseigné' }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-file-alt"></i> Documents</h6>
                        <p *ngIf="!company?.documents?.length">Non renseigné</p>
                        <ul *ngIf="company?.documents?.length">
                            <li *ngFor="let document of company?.documents">{{ document }}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6" *ngIf="company?.additionalFields?.length">
                <h6><i class="fas fa-plus-square"></i> Champs supplémentaires</h6>
                <table class="table table-striped">
                    <tbody>
                        <tr *ngFor="let field of company?.additionalFields">
                            <td><b>{{ field.key }}</b></td>
                            <td>{{ field.value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <br/>
        
        <div class="card">
            <div *ngIf="company?.employees?.length">
                <div class="card-header">
                    <h6>Liste des employés</h6>
                    <input type="text" class="form-control" placeholder="Rechercher un employé..." [(ngModel)]="employeeFilter" (input)="filterEmployees()" />
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Prénom</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Téléphone</th>
                                    <th>Rôle</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let employee of filteredEmployees" (click)="selectUser(employee)" class="hand-pointer">
                                    <td>{{ employee.firstName }}</td>
                                    <td>{{ employee.lastName }}</td>
                                    <td>
                                        <a href="mailto:{{ employee.email }}">
                                            {{ employee.email }}
                                        </a>
                                    </td>
                                    <td>{{ employee.phone }}</td>
                                    <td>
                                        <small class="role-badge" [ngClass]="getRoleClass(employee?.role)">
                                            {{ translateRole(employee.role) }}
                                        </small>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <br/>
        
        <div class="card">
            <div *ngIf="company?.contractsAsCustomer?.length">
                <div class="card-header">
                    <h6>Contrats en tant que client</h6>
                    <input type="text" class="form-control" placeholder="Rechercher un contrat..." [(ngModel)]="contractCustomerFilter" (input)="filterContracts('contractsAsCustomer')" />
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Numéro interne</th>
                                    <th>Service</th>
                                    <th>Adresse</th>
                                    <th>Numéro de devis</th>
                                    <th>Date de début</th>
                                    <th>Montant HT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let contract of filteredContractsAsCustomer">
                                    <td>{{ contract?.internal_number }}</td>
                                    <td>{{ contract?.benefit }}</td>
                                    <td>{{ contract?.address }}</td>
                                    <td>{{ contract?.quote_number }}</td>
                                    <td>{{ contract?.start_date_customer }}</td>
                                    <td>{{ contract?.amount_ht | currency:'EUR' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <br/>
        
        <div class="card">
            <div *ngIf="company?.contractsAsContact?.length">
                <div class="card-header">
                    <h6>Contrats en tant que contact</h6>
                    <input type="text" class="form-control" placeholder="Rechercher un contrat..." [(ngModel)]="contractContactFilter" (input)="filterContracts('contractsAsContact')" />
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Numéro interne</th>
                                    <th>Service</th>
                                    <th>Adresse</th>
                                    <th>Numéro de devis</th>
                                    <th>Date de début</th>
                                    <th>Montant HT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let contract of filteredContractsAsContact">
                                    <td>{{ contract?.internal_number }}</td>
                                    <td>{{ contract?.benefit }}</td>
                                    <td>{{ contract?.address }}</td>
                                    <td>{{ contract?.quote_number }}</td>
                                    <td>{{ contract?.start_date_works }}</td>
                                    <td>{{ contract?.amount_ht | currency:'EUR' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <br/>
        
        <div class="card">
            <div *ngIf="company?.contractsAsExternalContributor?.length">
                <div class="card-header">
                    <h6>Contrats en tant que contributeur externe</h6>
                    <input type="text" class="form-control" placeholder="Rechercher un contrat..." [(ngModel)]="contractExternalContributorFilter" (input)="filterContracts('contractsAsExternalContributor')" />
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Numéro interne</th>
                                    <th>Service</th>
                                    <th>Adresse</th>
                                    <th>Numéro de devis</th>
                                    <th>Date de début</th>
                                    <th>Montant HT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let contract of filteredContractsAsExternalContributor">
                                    <td>{{ contract?.internal_number }}</td>
                                    <td>{{ contract?.benefit }}</td>
                                    <td>{{ contract?.address }}</td>
                                    <td>{{ contract?.quote_number }}</td>
                                    <td>{{ contract?.start_date_works }}</td>
                                    <td>{{ contract?.amount_ht | currency:'EUR' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
