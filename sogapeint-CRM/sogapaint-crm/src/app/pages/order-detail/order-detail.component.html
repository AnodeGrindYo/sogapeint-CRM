<div class="container-fluid">
    <app-pagetitle title="Détails de la Commande" [breadcrumbItems]="breadCrumbItems"></app-pagetitle>
    <div class="row mb-3">
      <div class="col-12 mb-2">
        <h2>Détails de la Commande</h2>
        <div class="text-end">
          <!-- Le bouton Editer est placé ici conformément à la structure initiale fournie pour order-detail -->
          <button class="btn btn-primary ms-2" (click)="goToEditOrder()" *ngIf="isAdminOrSuperAdmin()">Editer</button>
        </div>
        <hr>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">Référence commande</div>
          <div class="card-body">
            <div class="mb-3">
              <label for="internal_number" class="form-label">Numéro Interne</label>
              <input type="text" id="internal_number" class="form-control" value="{{ contract?.internal_number }}" disabled>
            </div>
            <div class="mb-3">
              <label for="date_cde" class="form-label">Date de Commande</label>
              <input type="date" id="date_cde" class="form-control" value="{{ contract?.date_cde | date:'yyyy-MM-dd' }}" disabled>
            </div>
            <div class="mb-3">
              <label for="customer" class="form-label">Client</label>
              <input type="text" id="customer" class="form-control" value="{{ customer?.firstname+' '+customer?.lastname }}" disabled>
            </div>
            <div class="mb-3">
              <label for="contact" class="form-label">Contact</label>
              <input type="text" id="contact" class="form-control" value="{{ contact?.firstname+' '+contact?.lastname}}" disabled>
            </div>
            <div class="mb-3">
              <label for="benefit" class="form-label">Prestation</label>
              <input type="text" id="benefit" class="form-control" value="{{ benefit_name }}" disabled>
            </div>
            <div class="mb-3">
              <label for="status" class="form-label">Statut</label>
              <div class="row">
                <td class="cell-centered">
                    <span 
                    class="badge" 
                    [ngClass]="{
                        'bg-success': contract?.status === 'achieve',
                        'bg-warning': contract?.status === 'invoiced',
                        'bg-danger': contract?.status === 'anomaly',
                        'bg-secondary': contract?.status === 'in_progress',
                        'bg-pink': contract?.status === null,
                        'bg-info': contract?.status === 'canceled'
                    }">
                    {{ getStatus(contract?.status) }}
                    
                </span>
                </td>
                
              </div>
            </div>
            <div class="mb-3">
              <label for="quote_number" class="form-label">Numéro de devis</label>
              <input type="text" id="quote_number" class="form-control" value="{{ contract?.quote_number }}" disabled>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">Résidence/Adresse</div>
          <div class="card-body">
            <div class="mb-3">
              <label for="address" class="form-label">Adresse</label>
              <input type="text" id="address" class="form-control" value="{{ contract?.address }}" disabled>
            </div>
            <div class="mb-3">
              <label for="appartment_number" class="form-label">N° appart</label>
              <input type="text" id="appartment_number" class="form-control" value="{{ contract?.appartment_number }}" disabled>
            </div>
            <div class="mb-3">
              <label for="occupied" class="form-label">Occupé</label>
              <input type="text" id="occupied" class="form-control" value="{{ contract?.occupied ? 'Oui' : 'Non' }}" disabled>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Montants</div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Montant de la commande HT</label>
                <input type="text" class="form-control" value="{{ contract?.amount_ht | currency:'EUR' }}" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label">Montant de la prestation du co-traitant</label>
                <input type="text" class="form-control" value="{{ contract?.external_contributor_amount | currency:'EUR' }}" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label">Montant de la prestation du sous-traitant</label>
                <input type="text" class="form-control" value="{{ contract?.subcontractor_amount | currency:'EUR' }}" disabled>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
            <div class="card">
              <div class="card-header">Intervenants</div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="internal_contributor" class="form-label">Intervenant Sogapeint</label>
                  <input type="text" id="internal_contributor" class="form-control" value="{{ sogapeintContact?.firstname + ' ' + sogapeintContact?.lastname }}" disabled>
                </div>
                <div class="mb-3">
                  <label for="external_contributor" class="form-label">Co-traitant</label>
                  <input type="text" id="external_contributor" class="form-control" value="{{ coContractor?.firstname + ' ' + coContractor?.lastname }}" disabled>
                </div>
                <div class="mb-3">
                  <label for="subcontractor" class="form-label">Sous-traitant</label>
                  <input type="text" id="subcontractor" class="form-control" value="{{ subcontractor?.firstname + ' ' + subcontractor?.lastname }}" disabled>
                </div>
              </div>
            </div>
          </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Dates</div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Début des travaux</label>
                <input type="text" class="form-control" value="{{ contract?.start_date_works | date:'shortDate' }}" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label">Fin des travaux</label>
                <input type="text" class="form-control" value="{{ contract?.end_date_works | date:'shortDate' }}" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label">Date de fin client</label>
                <input type="text" class="form-control" value="{{ contract?.end_date_customer | date:'shortDate' }}" disabled>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Temps d'exécution</div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Jours (donnés)</label>
                    <input type="text" class="form-control" value="{{ contract?.prevision_data_day }}" disabled>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Heures (données)</label>
                    <input type="text" class="form-control" value="{{ contract?.prevision_data_hour }}" disabled>
                  </div>
              <div class="mb-3">
                <label class="form-label">Jours (Réalisés)</label>
                <input type="text" class="form-control" value="{{ contract?.execution_data_day }}" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label">Heures (Réalisées)</label>
                <input type="text" class="form-control" value="{{ contract?.execution_data_hour }}" disabled>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Facturation</div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Numéro de Facture</label>
                <input type="text" class="form-control" value="{{ contract?.invoice_number }}" disabled>
              </div>
              <div class="mb-3">
                <label class="form-label">Montant de la facture</label>
                <input type="text" class="form-control" value="{{ contract?.billing_amount | currency:'EUR' }}" disabled>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Communication et suivi</div>
            <div class="card-body">
              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="mail_sended" checked="{{ contract?.mail_sended }}" disabled>
                <label class="form-check-label" for="mail_sended">Mail envoyé</label>
              </div>
              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="trash" checked="{{ contract?.trash }}" disabled>
                <label class="form-check-label" for="trash">Marquer comme supprimé</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <!-- <div class="card">
            <div class="card-header">Activité du contrat</div>
            <div class="card-body"> -->
              <app-contract-activity [contractId]="contractId" [userId]="currentUser['userId']"></app-contract-activity>
            <!-- </div>
          </div>
        </div> -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Gestion des fichiers de la commande</div>
            <div class="card-body">
              <app-order-files-management [contractId]="contractId"></app-order-files-management>
            </div>
          </div>
        </div>
      </div>
      
  </div>
  