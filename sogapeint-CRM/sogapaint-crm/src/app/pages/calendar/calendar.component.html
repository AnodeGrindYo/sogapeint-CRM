<div class="container-fluid">
    <div class="row mb-4 align-items-center">
        <div class="col-md-6 d-flex align-items-center">
            <h4 class="mb-0 me-3">Calendrier des commandes</h4>
            <span class="badge bg-info fs-5">{{ periodTitle }}</span>
        </div>
        <div class="col-md-6 text-end">
            <div class="btn-group me-2">
                <button class="btn btn-outline-primary" (click)="prev()">
                    <i class="fa fa-angle-left"></i>
                </button>
                <button class="btn btn-outline-primary" (click)="today()">Aujourd'hui</button>
                <button class="btn btn-outline-primary" (click)="next()">
                    <i class="fa fa-angle-right"></i>
                </button>
            </div>
            <div class="btn-group">
                <button
                class="btn"
                [ngClass]="{
                    'btn-primary': view === CalendarView.Month,
                    'btn-outline-primary': view !== CalendarView.Month
                }"
                (click)="setView(CalendarView.Month)"
                >
                Mois
            </button>
            <button
            class="btn"
            [ngClass]="{
                'btn-primary': view === CalendarView.Week,
                'btn-outline-primary': view !== CalendarView.Week
            }"
            (click)="setView(CalendarView.Week)"
            >
            Semaine
        </button>
        <button
        class="btn"
        [ngClass]="{
            'btn-primary': view === CalendarView.Day,
            'btn-outline-primary': view !== CalendarView.Day
        }"
        (click)="setView(CalendarView.Day)"
        >
        Jour
    </button>
</div>
</div>
</div>

<div class="row">
    <div class="col-lg-3">
        <!-- Menu déroulant personnalisé pour les clients -->
        <div class="mb-3">
            <label for="clientFilter">Filtrer par client :</label>
            <div class="dropdown">
                <button
                class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                type="button"
                id="clientDropdown"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >
                {{ selectedClient || 'Tous les clients' }}
            </button>
            <ul class="dropdown-menu w-100 scrollable-menu" aria-labelledby="clientDropdown">
                <li>
                    <a
                    class="dropdown-item"
                    [ngClass]="{'active': selectedClient === null}"
                    (click)="selectClient(null)"
                    >
                    Tous les clients
                </a>
            </li>
            <li *ngFor="let client of clients">
                <a
                class="dropdown-item"
                [ngClass]="{
                    'active': selectedClient === client.name,
                    'text-white': calculateTextColor(client.color) === 'white',
                    'text-black': calculateTextColor(client.color) === 'black'
                }"
                [style.background-color]="client.color"
                (click)="selectClient(client)"
                >
                {{ client.name }}
            </a>
        </li>
    </ul>
</div>
</div>


<div class="mb-3">
    <label for="dateFilter">Filtrer par dates :</label>
    <div>
        <input
        type="radio"
        id="workDates"
        name="dateFilter"
        [(ngModel)]="filterByWorkDates"
        [value]="true"
        (change)="toggleDateFilter()"
        />
        <label for="workDates">Dates de travail</label>
    </div>
    <div>
        <input
        type="radio"
        id="clientDates"
        name="dateFilter"
        [(ngModel)]="filterByWorkDates"
        [value]="false"
        (change)="toggleDateFilter()"
        />
        <label for="clientDates">Dates client</label>
    </div>
</div>

<!-- Boutons des clients avec couleurs -->
<div class="mb-3">
    <label>Clients dans la période :</label>
    <div
    class="btn-group-vertical w-100"
    style="max-height: 300px; overflow-y: auto;"
    >
    <button
    class="btn text-start"
    [ngClass]="{
        'btn-primary': selectedClient === null,
        'btn-outline-secondary': selectedClient !== null
    }"
    (click)="selectClient(null)"
    >
    Tous les clients
</button>
<button
class="btn text-start"
*ngFor="let client of clientsInCurrentPeriod"
[style.background-color]="client.color"
[ngClass]="{
    'text-white': calculateTextColor(client.color) === 'white',
    'text-black': calculateTextColor(client.color) === 'black',
    'border border-2 border-dark': selectedClient === client.name
}"
(click)="selectClient(client)"
>
{{ client.name }}
</button>
</div>
</div>
</div>

<div class="col-lg-9">
    <div *ngIf="isLoading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
        </div>
    </div>
    <ng-container *ngIf="!isLoading">
        <!-- Vues du calendrier -->
        <mwl-calendar-month-view
        *ngIf="view === CalendarView.Month"
        [viewDate]="viewDate"
        [events]="filteredEvents"
        [activeDayIsOpen]="activeDayIsOpen"
        (dayClicked)="dayClicked($event)"
        >
    </mwl-calendar-month-view>
    
    <mwl-calendar-week-view
    *ngIf="view === CalendarView.Week"
    [viewDate]="viewDate"
    [events]="filteredEvents"
    [hourSegments]="2"
    >
</mwl-calendar-week-view>

<mwl-calendar-day-view
*ngIf="view === CalendarView.Day"
[viewDate]="viewDate"
[events]="filteredEvents"
>
</mwl-calendar-day-view>
</ng-container>
</div>
</div>
</div>
