<!-- /pages/contract-email-scheduler.component.html -->
<div class="card shadow-sm">
    <div class="card-header">
        Planification des Emails Récurrents
    </div>
    <div class="card-body">
        <div *ngIf="isLoading" class="text-center">
            <p>Chargement...</p>
        </div>
        <div class="contract-email-scheduler-component" *ngIf="!isLoading">
            <div *ngIf="infoMessage" class="alert alert-info">
                {{ infoMessage }}
            </div>
            <div class="alert alert-primary" *ngIf="internalNumber">
                <i class="fa fa-info-circle"></i>
                Nombre de commandes avec le numéro interne {{ internalNumber }} : {{ contracts.length }}
            </div>
            <div *ngIf="contracts.length > 0" class="mb-3">
                <h5>Commandes avec le numéro interne {{ internalNumber }} :</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">Prestation</th>
                            <th scope="col">Date de fin client</th>
                            <th scope="col">Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let contract of contracts">
                            <td>{{ getBenefitName(contract.benefit) }}</td>
                            <td>{{ contract.end_date_customer | date: 'dd/MM/yyyy' }}</td>
                            <td>{{ getStatus(contract.status) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <form [formGroup]="emailScheduleForm" (ngSubmit)="updateEmailSchedule()">
                <div class="mb-3">
                    <label for="nextEmailDate" class="form-label">Prochaine date d'envoi:</label>
                    <input type="date" id="nextEmailDate" formControlName="nextEmailDate" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="interval" class="form-label">Intervalle (jours):</label>
                    <input type="number" id="interval" formControlName="interval" class="form-control" required>
                </div>
                <div class="form-check mb-3">
                    <input type="checkbox" id="enabled" formControlName="enabled" class="form-check-input">
                    <label for="enabled" class="form-check-label">
                        Activer les emails récurrents
                    </label>
                </div>
                <div *ngIf="!canScheduleEmails()" class="alert alert-warning">
                    <i class="fa fa-exclamation-triangle"></i>
                    Vous ne pouvez pas programmer d'emails récurrents tant que toutes les commandes n'ont pas le statut "Réalisé" ou "Annulé".
                </div>
                <div class="text-end">
                    <button type="submit" class="btn btn-primary btn-lg" [disabled]="emailScheduleForm.invalid || !canScheduleEmails()">Mettre à jour</button>
                </div>
                <div *ngIf="errorMessage" class="text-danger mt-3">
                    {{ errorMessage }}
                </div>
                <div *ngIf="successMessage" class="text-success mt-3">
                    {{ successMessage }}
                </div>
            </form>
        </div>
    </div>
</div>
